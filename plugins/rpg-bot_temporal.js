let linkRegex = /chat.whatsapp.com\/([0-9A-Za-z]{20,24})/i
import fetch from 'node-fetch';

let handler = async (m, { conn, args, text, users, user, usedPrefix, command, isPrems, isOwner, isROwner}) => {
try {
let fkontak = { "key": { "participants":"0@s.whatsapp.net", "remoteJid": "status@broadcast", "fromMe": false, "id": "Halo" }, "message": { "contactMessage": { "vcard": `BEGIN:VCARD\nVERSION:3.0\nN:Sy;Bot;;;\nFN:y\nitem1.TEL;waid=${m.sender.split('@')[0]}:${m.sender.split('@')[0]}\nitem1.X-ABLabel:Ponsel\nEND:VCARD` }}, "participant": "0@s.whatsapp.net" }

let grupos = [nna, nn, nnn, nnnt, nnntt, nnnttt]
let gata = [img5, img6, img7, img8, img9]
let enlace = { contextInfo: { externalAdReply: {title: wm + ' 🐈', body: 'support group' , sourceUrl: grupos.getRandom(), thumbnail: await(await fetch(gata.getRandom())).buffer() }}}
let enlace2 = { contextInfo: { externalAdReply: { showAdAttribution: true, mediaUrl: yt, mediaType: 'VIDEO', description: '', title: wm, body: '🤖 𝐒𝐔𝐏𝐄𝐑 𝐌𝐀𝐊𝐀𝐍𝐀𝐊𝐘 - 𝐖𝐇𝐀𝐓𝐒𝐀𝐏𝐏 🤖', thumbnailUrl: await(await fetch(img)).buffer(), sourceUrl: yt }}}
let dos = [enlace, enlace2]  

let texto0 = `${ag}𝙼𝙸 𝙲𝚁𝙴𝙰𝙳𝙾𝚁 𝙷𝙰 𝚁𝙴𝚂𝚃𝙸𝙽𝙶𝚁𝙸𝙳𝙾 𝙴𝚂𝚃𝙰 𝙵𝚄𝙽𝙲𝙸𝙾́𝙽 𝙳𝙴 𝙸𝙽𝙶𝚁𝙴𝚂𝙰𝚁 𝙴𝙻 𝙱𝙾𝚃 𝚃𝙴𝙼𝙿𝙾𝚁𝙰𝙻𝙼𝙴𝙽𝚃𝙴 𝙰 𝙶𝚁𝚄𝙿𝙾𝚂 𝚅𝚄𝙴𝙻𝚅𝙰 𝙼𝙰𝚂 𝚃𝙰𝚁𝙳𝙴 𝙾 𝚄𝚂𝙴 𝙻𝙰 𝙵𝚄𝙽𝙲𝙸𝙾𝙽 *${usedPrefix}serbot*`
let texto1 = `${mg}𝚄𝚂𝙴 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 𝙲𝙾𝙼𝙾 𝙴𝚂𝚃𝙴 𝙴𝙹𝙴𝙼𝙿𝙻𝙾 :\n*${usedPrefix + command}* _enlace de Grupo y Número de Token(s)_\n*${usedPrefix + command}* ${grupos.getRandom()} 3*`
let texto2 = `${ag}¡𝚈𝙰 𝙽𝙾 𝚃𝙸𝙴𝙽𝙴𝚂 𝚃𝙾𝙺𝙴𝙽𝚂! ☹️\n\n𝙲𝙾𝙼𝙿𝚁𝙰 𝚃𝙾𝙺𝙴𝙽𝚂 𝙿𝙰𝚁𝙰 𝙿𝙾𝙳𝙴𝚁 𝚄𝙽𝙸𝚁 𝙰 𝙼𝙰𝙺𝙰𝙽𝙺𝚈 𝙰 𝚃𝚄 𝙶𝚁𝚄𝙿𝙾 𝙲𝙾𝙽 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 :`
let texto3 = `${fg}𝙴𝙽𝙻𝙰𝙲𝙴 𝙽𝙾 𝚅𝙰𝙻𝙸𝙳𝙾. 𝙳𝙴𝙱𝙴 𝚂𝙴𝚁 𝙴𝙽𝙻𝙰𝙲𝙴 𝙳𝙴 𝙶𝚁𝚄𝙿𝙾 𝙳𝙴 𝚆𝙷𝙰𝚃𝚂𝙰𝙿𝙿\n*${usedPrefix + command} ${grupos.getRandom()} 3*`
let texto4 = `${mg}𝙸𝙽𝙶𝚁𝙴𝚂𝙴 𝙴𝙻 𝙽𝚄𝙼𝙴𝚁𝙾 𝙳𝙴 𝚃𝙾𝙺𝙴𝙽(𝚂) 😁\n*3* 𝐓𝐎𝐊𝐄𝐍 ❤️ = *30* _minutos_`
let texto5 = `${fg}𝙼𝙸𝙽𝙸𝙼𝙾 *𝟹* 𝚃𝙾𝙺𝙴𝙽(𝚂) 𝙿𝙰𝚁𝙰 𝙿𝙾𝙳𝙴𝚁 𝚄𝙽𝙸𝚁 𝙰 𝙼𝙰𝙺𝙰𝙽𝙰𝙺𝚈`
let texto6 = `${fg}𝙼𝙰𝚇𝙸𝙼𝙾 *𝟹* 𝚃𝙾𝙺𝙴𝙽(𝚂) 𝙿𝙰𝚁𝙰 𝙿𝙾𝙳𝙴𝚁 𝚄𝙽𝙸𝚁 𝙰 𝙼𝙰𝙺𝙰𝙽𝙰𝙺𝚈`
let texto7 = `${eg}𝚂𝙴 𝙷𝙰 𝚄𝙽𝙸𝙳𝙾 𝙼𝙰𝙺𝙰𝙽𝙰𝙺𝚈 𝙰𝙻 𝙶𝚁𝚄𝙿𝙾! 💋`

let img1 = 'https://img.freepik.com/vector-premium/animacion-monedas-pixeles-imagenes-animacion-moneda-oro-ilustracion-vectorial_350225-3.jpg?w=2000'
let img2 ='https://img.freepik.com/premium-vector/set-8bit-pixel-graphics-icons-game-art-coins-gold-animation_534389-12.jpg?w=2000'

if (!global.db.data.settings[conn.user.jid].temporal) return await conn.reply(m.chat, texto0, fkontak, m)  
//conn.sendButton( m.chat, wm, texto0, null, [[`🙌 𝙎𝙊𝙇𝙄𝘾𝙄𝙏𝘼𝙍 𝘾𝙊𝙈𝘼𝙉𝘿𝙊`, `.reporte *Quiero unir a gataBot en mí Grupo. Por favor Active la función #botemporal*`], [`🍀 𝙈 𝙀 𝙉 𝙐`, `.menu`]], fkontak, m) 

if (!args[0]) return await conn.reply(m.chat, texto1, fkontak, m)  
let [_, code] = args[0].match(linkRegex) || []

if (!linkRegex.test(args[0])) return await conn.reply(m.chat, texto3, fkontak, m) 
//conn.sendButton( m.chat, wm, texto3, null, [[`🍀 𝙈 𝙀 𝙉 𝙐`, `.menu`]], fkontak, m)
let user = m.sender.split('@')[0] 

if (!(isPrems || isOwner || isROwner)) { //Para Usuarios
let who = m.mentionedJid && m.mentionedJid[0] ? m.mentionedJid[0] : m.fromMe ? conn.user.jid : m.sender
let mentionedJid = [who]
let username = conn.getName(who)
//if (!args[1]) throw `${mg}*USE EL COMANDO COMO ESTE EJEMPLO*\n*${usedPrefix + command} enlace y Número de Token(s)*\n\n*EJEMPLO*\n*${usedPrefix + command} ${nn} 3*\n\n*3 TOKEN 🪙 = 30 MINUTOS*`
//if (!linkRegex.test(args[0])) throw `${fg}𝙀𝙉𝙇𝘼𝘾𝙀 𝙉𝙊 𝙑𝘼𝙇𝙄𝘿𝙊.` //Aquí 
if (user.joincount <= 1) return conn.sendButton( m.chat, wm, texto2, img1, [[`🏪 𝘾𝙊𝙈𝙋𝙍𝘼𝙍 : 𝘽𝙐𝙔 3 ${rpgshopp.emoticon('joincount')}`, `.buy joincount 3`]], fkontak, m)
if (isNaN(args[1])) return conn.sendButton( m.chat, wm, texto4, img1, [[`🍀 𝙈 𝙀 𝙉 𝙐`, `.menu`]], fkontak, m)
if (args[1] < 3) return conn.sendButton( m.chat, wm, texto5, img2, [[`🍀 𝙈 𝙀 𝙉 𝙐`, `.menu`]], fkontak, m)
if (args[1] > 3) return conn.sendButton( m.chat, wm, texto6, img2, [[`🍀 𝙈 𝙀 𝙉 𝙐`, `.menu`]], fkontak, m) //Solo ingresará si tiene 3 Token(s)
 
await delay(3 * 3000)
let res = await conn.groupAcceptInvite(code)
await conn.reply(m.chat, texto7, fkontak, m) 
//await conn.sendButton( m.chat, texto7, `${await conn.getName(res)} | ` + wm, null, [[`🍀 𝙈 𝙀 𝙉 𝙐`, `.menu`]], fkontak, m).then(async() => { 
user.joincount -= args[1] 
var jumlahHari = 600000 * args[1] // 10 minutos | Usuarios
var now = new Date() * 1
 
if (now < global.db.data.chats[res].expired) global.db.data.chats[res].expired += jumlahHari
else global.db.data.chats[res].expired = now + jumlahHari
await conn.reply(res, `✅ ${gt} 𝚂𝙴 𝙷𝙰 𝚄𝙽𝙸𝙳𝙾 𝙰𝙻 𝙶𝚁𝚄𝙿𝙾! 💋\n${await conn.getName(res)}\n\n𝚁𝙴𝙲𝚄𝙴𝚁𝙳𝙴 𝚀𝚄𝙴 𝙴𝚂 ⏳ 𝚃𝙴𝙼𝙿𝙾𝚁𝙰𝙻, 𝚄𝚂𝙴 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 _*${usedPrefix}menu*_ 𝙿𝙰𝚁𝙰 𝚅𝙴𝚁 𝙴𝙻 𝙼𝙴𝙽𝚄́\n\n🚪 𝐌𝐄 𝐒𝐀𝐋𝐃𝐑𝐄́ 𝐀𝐔𝐓𝐎𝐌𝐀́𝐓𝐈𝐂𝐀𝐌𝐄𝐍𝐓𝐄 𝐄𝐍 :\n${msToDate(global.db.data.chats[res].expired - now)}\n\n*${username}* 𝙻𝙴 𝚀𝚄𝙴𝙳𝙰 *${user.joincount}* 𝚃𝙾𝙺𝙴𝙽(𝚂) ❤️\n\n❕ 𝙿𝚄𝙴𝙳𝙴 𝚄𝚂𝙰𝚁 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 *${usedPrefix + command}* 𝚃𝙰𝙼𝙱𝙸𝙴́𝙽 𝙴𝙽 𝙴𝙻 𝙶𝚁𝚄𝙿𝙾 𝙼𝙸𝙴𝙽𝚃𝚁𝙰𝚂 𝙴𝚂𝚃𝙴 𝚈𝙾\n\n❕\n*${usedPrefix + command}*\n\n❕ 𝙿𝙰𝚁𝙰 𝚄𝙽𝙰 𝙼𝙴𝙹𝙾𝚁 𝙴𝚇𝙿𝙴𝚁𝙴𝙽𝙲𝙸𝙰 𝙳𝙴𝙱𝙾 𝚂𝙴𝚁 𝙰𝙳𝙼𝙸𝙽\n\n❗ 𝙴𝙽 𝙲𝙰𝚂𝙾 𝚀𝚄𝙴 𝚄𝙽 𝙰𝙳𝙼𝙸𝙽 𝙼𝙴 𝙴𝙻𝙸𝙼𝙸𝙽𝙴 𝙳𝙴𝙻 𝙶𝚁𝚄𝙿𝙾 𝚈 𝚀𝚄𝙸𝙴𝚁𝙰 𝚀𝚄𝙴 𝚅𝚄𝙴𝙻𝚅𝙰 𝙽𝙾 𝚂𝙴 𝚅𝙰 𝙿𝙾𝙳𝙴𝚁`, m)  
await delay(2 * 2000)
await conn.sendMessage(res, { text: lenguajeGB.smsJoin(user), mentions: (await conn.groupMetadata(`${res}`)).participants.map(v => v.id) }, [user], { quoted: fkontak })
//for (let jid of global.owner.map(v => v.replace(/[^0-9]/g, '') + '@s.whatsapp.net').filter(v => v != conn.user.jid)) {
//let data = (await conn.onWhatsApp(jid))[0] || {}
  //if (data.exists) 
    //conn.reply(m.chat, `@${m.sender.split`@`[0]} adicional ${conn.user.name} a ${await conn.getName(res)}\njid: ${res}, el bot se apagará a tiempo: ${msToDate(global.db.data.chats[res].expired - now)}`, data.jid, m) 

} else if ((isOwner || !isPrems || isROwner)) { //Para Owner
let who = m.mentionedJid && m.mentionedJid[0] ? m.mentionedJid[0] : m.fromMe ? conn.user.jid : m.sender
let mentionedJid = [who]
let username = conn.getName(who)
  
if (user.joincount === 0 ) throw `${ag}¡𝚈𝙰 𝙽𝙾 𝚃𝙸𝙴𝙽𝙴𝚂 𝚃𝙾𝙺𝙴𝙽𝚂! ☹️\n\n𝙲𝙾𝙼𝙿𝚁𝙰 𝚃𝙾𝙺𝙴𝙽𝚂 𝙿𝙰𝚁𝙰 𝙿𝙾𝙳𝙴𝚁 𝙸𝙽𝚅𝙸𝚃𝙰𝚁 𝙰 𝚐𝚊𝚝𝚊𝙱𝙾𝚃 𝙰 𝚃𝚄́ 𝙶𝚁𝚄𝙿𝙾 𝙲𝙾𝙽 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 _*${usedPrefix}buy joincount 3*_ o _*${usedPrefix}buy Para ver la Tienda*_`
 if (!args[1]) throw `${mg}𝚄𝚂𝙴 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 𝙲𝙾𝙼𝙾 𝙴𝚂𝚃𝙴 𝙴𝙹𝙴𝙼𝙿𝙻𝙾 :\n_*${usedPrefix + command} enlace y Número de Token(s)*_\n\n𝐄𝐉𝐄𝐌𝐏𝐋𝐎 :\n*${usedPrefix + command} ${nn} 3*\n\n*3* 𝐓𝐎𝐊𝐄𝐍 ❤️ = *30* _minutos_`
if (!linkRegex.test(args[0])) throw `${fg}𝙴𝙽𝙻𝙰𝙲𝙴 𝙽𝙾 𝚅𝙰𝙻𝙸𝙳𝙾.` //Aquí 

await delay(3 * 3000)
let res = await conn.groupAcceptInvite(code) 
conn.reply(m.chat, `${eg}𝚂𝙴 𝙷𝙰 𝚄𝙽𝙸𝙳𝙾 𝙼𝙰𝙺𝙰𝙽𝙰𝙺𝚈 𝙰𝙻 𝙶𝚁𝚄𝙿𝙾! 💋`, m).then(async() => { //Si el Owner se une al Grupo no habrá temporizador
 var jumlahHari = 600000 * args[1] // 10 minutos | Owner
 var now = new Date() * 1
  if (now < global.db.data.chats[res].expired) global.db.data.chats[res].expired += jumlahHari
else global.db.data.chats[res].expired = now + jumlahHari

await conn.reply(res, `✅ ${gt} 𝚂𝙴 𝙷𝙰 𝚄𝙽𝙸𝙳𝙾 𝙰𝙻 𝙶𝚁𝚄𝙿𝙾!\n${await conn.getName(res)}\n\n𝚁𝙴𝙲𝚄𝙴𝚁𝙳𝙴 𝚀𝚄𝙴 𝙴𝚂 ⏳ 𝚃𝙴𝙼𝙿𝙾𝚁𝙰𝙻, 𝚄𝚂𝙴 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 *_${usedPrefix}menu_* 𝙿𝙰𝚁𝙰 𝚅𝙴𝚁 𝙴𝙻 𝙼𝙴𝙽𝚄́\n\n🚪 𝐌𝐄 𝐒𝐀𝐋𝐃𝐑𝐄́ 𝐀𝐔𝐓𝐎𝐌𝐀́𝐓𝐈𝐂𝐀𝐌𝐄𝐍𝐓𝐄 𝐄𝐍 :\n${msToDate(global.db.data.chats[res].expired - now)}\n\n${username} 𝙻𝙴 𝚀𝚄𝙴𝙳𝙰 ${user.joincount} 𝚃𝙾𝙺𝙴𝙽(𝚂) ❤️\n\n❕ 𝙿𝚄𝙴𝙳𝙴 𝚄𝚂𝙰𝚁 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾 𝚃𝙰𝙼𝙱𝙸𝙴́𝙽 𝙴𝙽 𝙴𝙻 𝙶𝚁𝚄𝙿𝙾 𝙼𝙸𝙴𝙽𝚃𝚁𝙰𝚂 𝙴𝚂𝚃𝙴 𝚈𝙾\n\n❕ 𝚂𝙸 𝚀𝚄𝙸𝙴𝚁𝙴 𝚀𝚄𝙴 𝙴𝚂𝚃𝙴 𝙿𝙾𝚁 𝙼𝙰́𝚂 𝚃𝙸𝙴𝙼𝙿𝙾 𝙰𝚄𝙼𝙴𝙽𝚃𝙴 𝙴𝙻 𝙽𝚄́𝙼𝙴𝚁𝙾 𝙳𝙴 𝚃𝙾𝙺𝙴𝙽𝚂 𝙲𝚄𝙰𝙽𝙳𝙾 𝚄𝚂𝙴 𝙴𝙻 𝙲𝙾𝙼𝙰𝙽𝙳𝙾\n*${usedPrefix + command}*\n\n❗ 𝙴𝙽 𝙲𝙰𝚂𝙾 𝚀𝚄𝙴 𝚄𝙽 𝙰𝙳𝙼𝙸𝙽 𝙼𝙴 𝙴𝙻𝙸𝙼𝙸𝙽𝙴 𝙳𝙴𝙻 𝙶𝚁𝚄𝙿𝙾 𝚈 𝚀𝚄𝙸𝙴𝚁𝙰 𝚀𝚄𝙴 𝚅𝚄𝙴𝙻𝚅𝙰 𝙽𝙾 𝚂𝙴 𝚅𝙰 𝙿𝙾𝙳𝙴𝚁`, fkontak, m)  
await delay(2 * 2000)
await conn.sendMessage(res, { text: lenguajeGB.smsJoin(user), mentions: (await conn.groupMetadata(`${res}`)).participants.map(v => v.id) }, [user], { quoted: fkontak })

for (let jid of global.owner.map(v => v.replace(/[^0-9]/g, '') + '@s.whatsapp.net').filter(v => v != m.sender)) {
let data = (await conn.onWhatsApp(jid))[0] || {}
  if (data.exists) 
    conn.reply(m.chat, `@${m.sender.split`@`[0]} 𝙰𝙳𝙸𝙲𝙸𝙾𝙽𝙰𝙻 ${conn.user.name} a ${await conn.getName(res)}\n𝐉𝐈𝐃 : ${res}, 𝙴𝙻 𝙱𝙾𝚃 𝚂𝙴 𝙰𝙿𝙰𝙶𝙰𝚁𝙰́ 𝙰 𝚃𝙸𝙴𝙼𝙿𝙾 : ${msToDate(global.db.data.chats[res].expired - now)}`, data.jid, m)
                
} conn.sendButton(m.chat, '', wm, null, [['Creador', `/creador`], ['𝙑𝙤𝙡𝙫𝙚𝙧 𝙖𝙡 𝙈𝙚𝙣𝙪́ ☘️', '/menu']], m, res) })}
} catch (e) {
await conn.reply(m.chat, `${fg}\`\`\`𝐏𝐎𝐒𝐈𝐁𝐋𝐄𝐒 𝐂𝐀𝐔𝐒𝐀𝐒
- 𝙴𝙻 𝙴𝙽𝙻𝙰𝙲𝙴 𝙴𝚂𝚃𝙰 𝙸𝙽𝙲𝙾𝚁𝚁𝙴𝙲𝚃𝙾 𝙾 𝙲𝙰𝙳𝚄𝙲𝙰𝙳𝙾.

- 𝙽𝙾 𝙼𝙴 𝙿𝚄𝙴𝙳𝙾 𝚄𝙽𝙸𝚁 𝚂𝙸 𝙿𝚁𝙴𝚅𝙸𝙰𝙼𝙴𝙽𝚃𝙴 𝙼𝙴 𝙷𝙰𝙽 𝙴𝙻𝙸𝙼𝙸𝙽𝙰𝙳𝙾 𝙳𝙴𝙻 𝙶𝚁𝚄𝙿𝙾.

- 𝙴𝙻 𝙶𝚁𝚄𝙿𝙾 𝙴𝚂𝚃𝙰 𝙻𝙻𝙴𝙽𝙾, 𝙿𝙾𝚁 𝙴𝙽𝙳𝙴 𝙽𝙾 𝙿𝚄𝙴𝙳𝙾 𝚄𝙽𝙸𝚁𝙼𝙴.
\`\`\``, m)
console.log(e)}
}
handler.help = ['temporal', 'tiempo']
handler.command = ['bottemporal', 'botemporal', 'addbot', 'botadd']
handler.register = true
export default handler
const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms))

function msToDate(ms) {
let temp = ms
let days = Math.floor(ms / (24 * 60 * 60 * 1000));
let daysms = ms % (24 * 60 * 60 * 1000);
let hours = Math.floor((daysms) / (60 * 60 * 1000));
let hoursms = ms % (60 * 60 * 1000);
let minutes = Math.floor((hoursms) / (60 * 1000));
let minutesms = ms % (60 * 1000);
let sec = Math.floor((minutesms) / (1000));
return days + " 𝙳𝙸́𝙰(𝚂) ☀️\n" + hours + " 𝙷𝙾𝚁𝙰(𝚂) ⏳\n" + minutes + " 𝙼𝙸𝙽𝚄𝚃𝙾(𝚂) ⏰\n" + sec + " 𝚂𝙴𝙶𝚄𝙽𝙳𝙾(𝚂) 🕐\n";
}
